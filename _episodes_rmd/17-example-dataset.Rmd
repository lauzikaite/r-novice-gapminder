---
title: "Mortality and survival in Game of Thrones"
teaching: 15
exercises: 40
questions:
- "How can I perform preliminary data quality visualisations?"
objectives:
- Learn how to undertake simple dataset review and visualitions
- Perform suvival analyses
keypoints:
- "Load data into R."
- "Perform basic data visualisations using ggplot2"
source: Rmd
---

```{r, include=FALSE}
source("../bin/chunk-options.R")
knitr_fig_path("17-")
```

Let's start by downnloading Game of Thrones characters' mortality data, that was published [here](https://figshare.com/articles/Game_of_Thrones_mortality_and_survival_dataset/8259680?mc_cid=6ee60dc1ef&mc_eid=f10fe3b3f2). Please save the following two files using `File - Save As` dialog in your browser.

1. Original [characters data](https://raw.githubusercontent.com/lauzikaite/r-novice-gapminder/gh-pages/_episodes_rmd/data/character_data_S01-S08.csv)
2. Additional [data encoding](https://raw.githubusercontent.com/lauzikaite/r-novice-gapminder/gh-pages/_episodes_rmd/data/encoding.csv) table

> ## Challenge 1
>
> Save all three files your `data/` directory and change the working directory to it.
> Now read the `data/character_data_S01-S08.csv` and `encoding.csv` files into R.
>
> > ## Solution to Challenge 1
> >
> > ```{r, eval=FALSE}
> > setwd('path/to/data')
> > got_dat <- read.csv(file = "character_data_S01-S08.csv", header = TRUE, stringsAsFactors = FALSE)
> > meta <- read.csv(file = "encoding.csv", header = TRUE, stringsAsFactors = FALSE)
> > ```
> {: .solution}
{: .challenge}

```{r, eval=TRUE, echo=FALSE}
got_dat <- read.csv(file = "./data/character_data_S01-S08.csv", header = TRUE, stringsAsFactors = FALSE)
meta <- read.csv(file = "./data/encoding.csv", header = TRUE, stringsAsFactors = FALSE)
```

Once that data is loaded, let's evualuate its quality.

> ## Challenge 2
>
> Does the table with GoT characters's mortality data look correct? Are there any missing entries? 
>
> > ## Solution to Challenge 2
> > Note that there are many ways to do it.
> > ```{r}
> > ## make a summary for each column 
> > summary(got_dat)
> > ```
> >
> > The last five columns have no entries at all and should be removed to not interfer with statistical analyses.
> > ```{r}
> > ## remove columns that only contain NAs as entries
> > got <- got_dat[ , which(!apply(got_dat, 2, function(x) all(is.na(x))))]
> > ```
> {: .solution}
{: .challenge}

## Graphical data exploration

To make graphical data visulisations, we will be using `ggplot`  library.

```{r, warning=FALSE,message=FALSE}
library(ggplot2)
```

First, we will make plots to check the distribution of different variables:

**Categorical**:

* sex
* religion
* occupation
* social_status
* allegiance
* ...

Type of **occupation** was categorised as “silk collar” (e.g. clergy, merchants, politicians, and rulers) or “boiled leather collar” (e.g. warriors, farmers, and other occupations relying heavily on manual work). 
Type of **social status** was categorised as “highborn” (lords, ladies, or legitimate offspring) or “lowborn” (all other characters).

Because some characters switched **allegiance** during the show, both their last known allegiance and whether or not they switched allegiance during the show were recorded.

**Continuous**:

* exp_time_sec, survival time of character
* intro_time_sec, cumulative net running time when character first appeared
* dth_episode, number of the episode in which character died
* prominence
* ...

A proxy measure for how prominently a character featured in the show was provided in the data. This **prominence** score was calculated by taking the number of episodes that a character appeared in and dividing that by the number of total episodes that the character could have appeared in (i.e. the number of episodes occurring from the character first being introduced until the point of death or censoring). This ratio was then multiplied by the number of seasons that the character had featured in.

> ## Quick question
>
> What every other variable in the dataset is: categorical or continuous?
{: .callout}

## Distribution

To begin with, let's compare three categorical variables at a time, e.g. occupation vs sex vs social status.

```{r}
ggplot(got) +
  geom_histogram(aes(x = factor(occupation), fill = factor(social_status)), stat = "count") +
  facet_wrap(~sex) +
  scale_x_discrete(name = "occupation") +
  scale_fill_viridis_d(name = "social status")
```
